# Property of Unyte Africa
# This file is used to define the container services that will be run in the local environment
services:
  cache:
    image: redis:6.2-alpine
    container_name: cachebros
    ports:
      - 6379:6379
    volumes:
      - redis_data:/data:rw

  worker:
    build:
      context: ../../
      dockerfile: Dockerfile
    container_name: jobberman
    command: celery -A superpool.api.celery worker --pool=prefork --concurrency=4
    depends_on:
      - cache
    environment:
      CELERY_BROKER_URL: redis://cache:6379/0  # Redis broker URL
      CELERY_RESULT_BACKEND: redis://cache:6379/0  # Use Redis as the result backend
      DATABASE_URL: ${DATABASE_URL}
    volumes:
      - ../../superpool/api:/app/superpool/api

  flower:
    build:
      context: ../../
      dockerfile: Dockerfile
    container_name: superpool_flower
    command: celery -A superpool.api.celery flower --port=5555
    environment:
      CELERY_BROKER_URL: redis://cache:6379/0  # Redis broker URL for Flower
    ports:
      - 5555:5555
    depends_on:
      - cache
      - worker
    volumes:
      - ../../superpool/api:/app/superpool/api

volumes:
  redis_data: {}
